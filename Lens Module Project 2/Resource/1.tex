Intersect(RefractionRay_{Final},eq1)

Intersect(

  If(
    
  (n_{Lens})/(n_{Out})) sin(Angle(RefractionRay_{1},Normal_{2nd,InRe}))â‰¥1,
  
  Ray(Incident_{3rd,TIR,InRe},Rotate_{3rd,Refraction}),
  
  Ray(  if(
    

    isdefined(Intersect(RefractionRay_{1},Arc_{2nd,InRe},1)),

    Intersect(RefractionRay_{1},Arc_{2nd,InRe},1),

    isdefined(Intersect(RefractionRay_{1},Arc_{2nd,InRe},2)),

    Intersect(RefractionRay_{1},Arc_{2nd,InRe},2)

  ),
  
  Rotate_{2nd,Refraction})),
  
  eq1
  
)